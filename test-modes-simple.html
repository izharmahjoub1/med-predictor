<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Test Simple des Modes</title>
    <style>
        .mode-selector {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-selector.active {
            background-color: #2563eb;
            color: white;
        }
        .mode-selector:not(.active) {
            background-color: #f3f4f6;
            color: #374151;
        }
        .mode-section {
            padding: 20px;
            margin: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        .mode-section.hidden {
            display: none;
        }
        .console-vocal {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }
        .console-manuel {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        .console-ocr {
            background-color: #dcfce7;
            border-color: #22c55e;
        }
        .console-fhir {
            background-color: #f3e8ff;
            border-color: #8b5cf6;
        }
        .debug-info {
            background-color: #fef2f2;
            border: 1px solid #ef4444;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test Simple des Modes</h1>
    
    <!-- Boutons de sÃ©lection de mode -->
    <div>
        <button type="button" id="mode-manuel" class="mode-selector active">Mode Manuel</button>
        <button type="button" id="mode-vocal" class="mode-selector">Mode Vocal</button>
        <button type="button" id="mode-ocr" class="mode-selector">Mode OCR</button>
        <button type="button" id="mode-fhir" class="mode-selector">Mode FHIR</button>
    </div>
    
    <!-- Sections de contenu -->
    <div id="manual-mode-section" class="mode-section console-manuel">
        <h2>ğŸ“ Mode Manuel</h2>
        <p>Formulaire manuel pour saisir les donnÃ©es du patient.</p>
        <input type="text" placeholder="Nom du patient" class="w-full p-2 border rounded">
    </div>
    
    <div id="vocal-mode-section" class="mode-section console-vocal hidden">
        <h2>ğŸ¤ Mode Vocal</h2>
        <p>Console vocale pour la reconnaissance de la parole.</p>
        <div id="init-service" class="p-3 bg-yellow-100 rounded mb-2">
            <button id="init-service-btn">ğŸ§ª Tester le Service</button>
        </div>
        <div id="start-recording-btn" class="p-3 bg-green-100 rounded mb-2">
            <button>ğŸ¤ DÃ©marrer Reconnaissance</button>
        </div>
        <div id="stop-recording-btn" class="p-3 bg-red-100 rounded mb-2 hidden">
            <button>â¹ï¸ ArrÃªter</button>
        </div>
        <div id="voice-status" class="p-3 bg-blue-100 rounded">
            Statut: PrÃªt
        </div>
    </div>
    
    <div id="ocr-mode-section" class="mode-section console-ocr hidden">
        <h2>ğŸ“· Mode OCR</h2>
        <p>Reconnaissance optique de caractÃ¨res pour les documents.</p>
    </div>
    
    <div id="fhir-mode-section" class="mode-section console-fhir hidden">
        <h2>ğŸ¥ Mode FHIR</h2>
        <p>IntÃ©gration avec le standard FHIR pour les donnÃ©es mÃ©dicales.</p>
    </div>
    
    <!-- Informations de debug -->
    <div class="debug-info">
        <h3>ğŸ› Debug Info</h3>
        <div>Mode actuel: <span id="debug-current-mode">MANUEL</span></div>
        <div>ModeManager initialisÃ©: <span id="debug-manager-status">âŒ</span></div>
        <div>Console vocale visible: <span id="debug-vocal-visible">âŒ</span></div>
    </div>
    
    <!-- Boutons de test -->
    <div style="margin: 20px;">
        <button onclick="testModeManager()" style="padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; margin: 5px;">
            ğŸ§ª Tester ModeManager
        </button>
        <button onclick="forceSwitchMode('vocal')" style="padding: 10px; background: #f59e0b; color: white; border: none; border-radius: 5px; margin: 5px;">
            ğŸ”„ Forcer Mode Vocal
        </button>
        <button onclick="forceSwitchMode('manual')" style="padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px; margin: 5px;">
            ğŸ”„ Forcer Mode Manuel
        </button>
    </div>

    <script>
        // ğŸ¯ GESTIONNAIRE DE MODES SIMPLIFIÃ‰
        class ModeManager {
            constructor() {
                this.currentMode = 'manual';
                this.modes = ['manual', 'vocal', 'ocr', 'fhir'];
                this.modeElements = {};
                this.modeSections = {};
                this.init();
            }
            
            init() {
                console.log('ğŸ”§ Initialisation du gestionnaire de modes...');
                
                // Initialiser les rÃ©fÃ©rences aux Ã©lÃ©ments
                this.initializeElements();
                
                // Configurer les event listeners
                this.setupEventListeners();
                
                // Initialiser la visibilitÃ© des sections
                this.initializeSectionVisibility();
                
                console.log('âœ… Gestionnaire de modes initialisÃ© avec succÃ¨s !');
            }
            
            initializeElements() {
                // Boutons de sÃ©lection de mode
                this.modeElements = {
                    manual: document.getElementById('mode-manuel'),
                    vocal: document.getElementById('mode-vocal'),
                    ocr: document.getElementById('mode-ocr'),
                    fhir: document.getElementById('mode-fhir')
                };
                
                // Sections de contenu des modes
                this.modeSections = {
                    manual: document.getElementById('manual-mode-section'),
                    vocal: document.getElementById('vocal-mode-section'),
                    ocr: document.getElementById('ocr-mode-section'),
                    fhir: document.getElementById('fhir-mode-section')
                };
                
                // VÃ©rifier que tous les Ã©lÃ©ments nÃ©cessaires sont prÃ©sents
                Object.entries(this.modeElements).forEach(([mode, element]) => {
                    if (element) {
                        console.log(`âœ… Ã‰lÃ©ment ${mode} trouvÃ©:`, element);
                    } else {
                        console.warn(`âš ï¸ Ã‰lÃ©ment ${mode} non trouvÃ©`);
                    }
                });
            }
            
            setupEventListeners() {
                Object.entries(this.modeElements).forEach(([mode, element]) => {
                    if (element) {
                        element.addEventListener('click', () => {
                            console.log(`ğŸ¯ Clic sur le mode ${mode}`);
                            this.switchMode(mode);
                        });
                        
                        // Nettoyer les onclick inline
                        element.removeAttribute('onclick');
                        
                        console.log(`âœ… Event listener configurÃ© pour le mode ${mode}`);
                    }
                });
            }
            
            initializeSectionVisibility() {
                console.log('ğŸ”§ Initialisation de la visibilitÃ© des sections...');
                
                // Forcer l'affichage du mode manuel par dÃ©faut
                const manualSection = document.getElementById('manual-mode-section');
                if (manualSection) {
                    manualSection.classList.remove('hidden');
                    console.log('âœ… Section manuelle forcÃ©e Ã  visible');
                }
                
                // Forcer le masquage de toutes les autres sections
                const otherSections = ['vocal-mode-section', 'ocr-mode-section', 'fhir-mode-section'];
                otherSections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('hidden');
                        console.log(`âœ… Section ${sectionId} forcÃ©e Ã  cachÃ©e`);
                    }
                });
            }
            
            switchMode(targetMode) {
                if (!this.modes.includes(targetMode)) {
                    console.error(`âŒ Mode invalide: ${targetMode}`);
                    return;
                }
                
                console.log(`ğŸ”„ Commutation vers le mode: ${targetMode}`);
                
                // Masquer les Ã©lÃ©ments vocaux en mode manuel
                if (targetMode === 'manual') {
                    this.hideVocalElementsInManualMode(targetMode);
                }
                
                // Mettre Ã  jour l'Ã©tat des boutons
                this.updateButtonStates(targetMode);
                
                // Mettre Ã  jour l'affichage des sections
                this.updateSectionVisibility(targetMode);
                
                // Mettre Ã  jour le mode actuel
                this.currentMode = targetMode;
                
                // Mettre Ã  jour l'indicateur de debug
                this.updateDebugInfo();
                
                console.log(`âœ… Mode ${targetMode} activÃ© avec succÃ¨s !`);
            }
            
            updateButtonStates(activeMode) {
                Object.entries(this.modeElements).forEach(([mode, element]) => {
                    if (element) {
                        if (mode === activeMode) {
                            // Mode actif
                            element.classList.remove('bg-gray-100', 'text-gray-700');
                            element.classList.add('active');
                        } else {
                            // Mode inactif
                            element.classList.remove('active');
                            element.classList.add('bg-gray-100', 'text-gray-700');
                        }
                    }
                });
            }
            
            updateSectionVisibility(activeMode) {
                console.log(`ğŸ”§ updateSectionVisibility appelÃ© pour le mode: ${activeMode}`);
                
                Object.entries(this.modeSections).forEach(([mode, section]) => {
                    if (section) {
                        if (mode === activeMode) {
                            // Section active
                            section.classList.remove('hidden');
                            console.log(`âœ… Section ${mode} activÃ©e`);
                        } else {
                            // Section inactive
                            section.classList.add('hidden');
                            console.log(`âœ… Section ${mode} masquÃ©e`);
                        }
                    }
                });
            }
            
            hideVocalElementsInManualMode(currentMode) {
                console.log(`ğŸ”§ Masquage des Ã©lÃ©ments vocaux en mode ${currentMode}...`);
                
                if (currentMode === 'manual') {
                    const vocalElements = [
                        'init-service',
                        'start-recording-btn',
                        'stop-recording-btn',
                        'transfer-to-form-btn',
                        'voice-status',
                        'audio-activity-indicator'
                    ];
                    
                    vocalElements.forEach(elementId => {
                        const element = document.getElementById(elementId);
                        if (element) {
                            element.classList.add('hidden');
                            console.log(`âœ… Ã‰lÃ©ment vocal ${elementId} masquÃ© en mode manuel`);
                        }
                    });
                }
            }
            
            updateDebugInfo() {
                const debugMode = document.getElementById('debug-current-mode');
                const debugManager = document.getElementById('debug-manager-status');
                const debugVocal = document.getElementById('debug-vocal-visible');
                
                if (debugMode) debugMode.textContent = this.currentMode.toUpperCase();
                if (debugManager) debugManager.textContent = 'âœ…';
                
                const vocalSection = document.getElementById('vocal-mode-section');
                if (debugVocal && vocalSection) {
                    debugVocal.textContent = vocalSection.classList.contains('hidden') ? 'âŒ' : 'âœ…';
                }
            }
        }
        
        // ğŸš€ INITIALISATION DU SYSTÃˆME DE MODES
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ DOM chargÃ©, initialisation du systÃ¨me de modes...');
            
            try {
                window.modeManager = new ModeManager();
                console.log('âœ… SystÃ¨me de modes initialisÃ© avec succÃ¨s !');
                
                // Mettre Ã  jour les infos de debug
                if (window.modeManager) {
                    window.modeManager.updateDebugInfo();
                }
            } catch (error) {
                console.error('âŒ Erreur lors de l\'initialisation du systÃ¨me de modes:', error);
            }
        });
        
        // ğŸ§ª FONCTIONS DE TEST
        function testModeManager() {
            console.log('ğŸ§ª Test du ModeManager...');
            
            if (window.modeManager) {
                console.log('âœ… ModeManager trouvÃ©:', window.modeManager);
                console.log('âœ… Mode actuel:', window.modeManager.currentMode);
                console.log('âœ… Ã‰lÃ©ments initialisÃ©s:', window.modeManager.modeElements);
                console.log('âœ… Sections initialisÃ©es:', window.modeManager.modeSections);
                
                // Tester le basculement vers le mode vocal
                window.modeManager.switchMode('vocal');
            } else {
                console.error('âŒ ModeManager non trouvÃ©');
            }
        }
        
        function forceSwitchMode(mode) {
            console.log(`ğŸ”„ ForÃ§age du basculement vers le mode ${mode}...`);
            
            if (window.modeManager) {
                window.modeManager.switchMode(mode);
            } else {
                console.error('âŒ ModeManager non trouvÃ©');
            }
        }
    </script>
</body>
</html>
