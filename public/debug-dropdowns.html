<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dropdowns</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">üêõ Debug Dropdowns</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">üîç Test Search</h3>
            <input type="text" id="test-search" placeholder="Type 'cardio' to test" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <button onclick="testSearch()" class="px-4 py-2 bg-blue-500 text-white rounded">Test Search</button>
            <div id="search-results" class="mt-4 p-4 bg-gray-50 rounded"></div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-4">üìä Debug Info</h3>
            <div id="debug-info" class="text-sm font-mono bg-black text-green-400 p-4 rounded max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // Debug logging
        function debug(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }

        // Test search function
        async function testSearch() {
            const query = document.getElementById('test-search').value || 'cardio';
            const resultsDiv = document.getElementById('search-results');
            
            debug('=== STARTING SEARCH TEST ===');
            debug(`Query: "${query}"`);
            
            try {
                debug('üîç Calling ICD-11 proxy...');
                
                const response = await fetch(`/api/proxy/icd11?q=${encodeURIComponent(query)}&filters=${encodeURIComponent(JSON.stringify(['cardiovascular']))}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                debug(`Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                debug('‚úÖ Proxy response received');
                debug(`Data: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success && data.results && data.results.length > 0) {
                    resultsDiv.innerHTML = `
                        <h4 class="font-semibold mb-2">‚úÖ Search Results:</h4>
                        ${data.results.map(item => `
                            <div class="p-2 bg-blue-50 border border-blue-200 rounded mb-2">
                                <strong>${item.title}</strong> (${item.code})
                            </div>
                        `).join('')}
                    `;
                    debug('‚úÖ Results displayed successfully');
                } else {
                    resultsDiv.innerHTML = '<div class="text-yellow-500">No results found</div>';
                    debug('‚ö†Ô∏è No results found');
                }

            } catch (error) {
                debug(`‚ùå ERROR: ${error.message}`);
                resultsDiv.innerHTML = `<div class="text-red-500">Error: ${error.message}</div>`;
            }
        }

        // Auto-test on page load
        window.addEventListener('load', function() {
            debug('=== PAGE LOADED ===');
            debug('Ready to test search');
        });
    </script>
</body>
</html> 