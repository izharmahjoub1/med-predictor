<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagramme Dentaire - Drag Fix√©</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .content {
            padding: 30px;
        }
        
        .dental-chart-container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .image-container {
            position: relative;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            width: 100%;
            height: 600px;
            cursor: default;
        }
        
        .dental-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            opacity: 0.9;
            pointer-events: none;
        }
        
        .tooth-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .tooth-zone {
            position: absolute;
            width: 30px;
            height: 20px;
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            cursor: pointer;
            pointer-events: all;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #1f2937;
            border-radius: 4px;
            user-select: none;
            z-index: 10;
        }
        
        .tooth-zone:hover {
            background: rgba(59, 130, 246, 0.4);
            border-color: #1d4ed8;
            transform: scale(1.1);
            z-index: 20;
        }
        
        .tooth-zone.selected {
            background: rgba(59, 130, 246, 0.6);
            border-color: #1d4ed8;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
            z-index: 30;
        }
        
        .tooth-zone.dragging {
            opacity: 0.8;
            z-index: 100;
            cursor: grabbing !important;
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.3);
        }
        
        .tooth-zone.fixed {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 4px rgba(16, 185, 129, 0.5);
        }
        
        .info-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .tooth-info {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .tooth-details {
            margin-top: 15px;
        }
        
        .tooth-details p {
            margin: 8px 0;
            color: #4a5568;
        }
        
        .no-selection {
            text-align: center;
            color: #718096;
            font-style: italic;
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: #6b7280;
        }
        
        .btn.secondary:hover {
            background: #4b5563;
        }
        
        .btn.success {
            background: #10b981;
        }
        
        .btn.success:hover {
            background: #059669;
        }
        
        .btn.warning {
            background: #f59e0b;
        }
        
        .btn.warning:hover {
            background: #d97706;
        }
        
        .btn.danger {
            background: #ef4444;
        }
        
        .btn.danger:hover {
            background: #dc2626;
        }
        
        .stats {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .stats h4 {
            margin-top: 0;
            color: #2d3748;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #718096;
        }
        
        .history {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .history h4 {
            margin-top: 0;
            color: #2d3748;
        }
        
        .history-item {
            background: #f7fafc;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 0.9em;
            color: #4a5568;
        }
        
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        
        .image-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .image-info h5 {
            margin: 0 0 10px 0;
            color: #234e52;
        }
        
        .image-info p {
            margin: 5px 0;
            color: #2d3748;
            font-size: 0.9em;
        }
        
        .debug-info {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        .zone-controls {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .zone-controls h5 {
            margin: 0 0 10px 0;
            color: #0c4a6e;
        }
        
        .zone-controls p {
            margin: 5px 0;
            color: #0c4a6e;
            font-size: 0.9em;
        }
        
        .position-display {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.8em;
        }
        
        .drag-instructions {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .drag-instructions h5 {
            margin: 0 0 10px 0;
            color: #92400e;
        }
        
        .drag-instructions p {
            margin: 5px 0;
            color: #92400e;
            font-size: 0.9em;
        }
        
        .drag-status {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .drag-status h5 {
            margin: 0 0 10px 0;
            color: #991b1b;
        }
        
        .drag-status p {
            margin: 5px 0;
            color: #991b1b;
            font-size: 0.9em;
        }
        
        .status-active {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .status-active h5,
        .status-active p {
            color: #166534;
        }
        
        .fixed-zones {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .fixed-zones h5 {
            margin: 0 0 10px 0;
            color: #166534;
        }
        
        .fixed-zones p {
            margin: 5px 0;
            color: #166534;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>ü¶∑ Diagramme Dentaire - Drag Fix√©</h1>
                <p>Version avec syst√®me de drag and drop qui fixe les positions</p>
            </div>
            
            <div class="content">
                <div class="image-info">
                    <h5>üì∏ Image de R√©f√©rence Directe</h5>
                    <p><strong>Source :</strong> Votre image r√©aliste de dents</p>
                    <p><strong>Fichier :</strong> dental-reference.jpg (69KB)</p>
                    <p><strong>M√©thode :</strong> Drag & Drop avec fixation des positions</p>
                </div>
                
                <div class="debug-info">
                    <h5>üîß Mode Debug</h5>
                    <p><strong>Instructions :</strong> Cliquez sur les zones bleues pour s√©lectionner les dents</p>
                    <p><strong>Dent s√©lectionn√©e :</strong> <span v-if="selectedTooth" style="color: #3b82f6; font-weight: bold;">{{ selectedTooth }}</span><span v-else style="color: #718096;">Aucune</span></p>
                    <p><strong>Total clics :</strong> {{ toothHistory.length }}</p>
                    <p><strong>Mode drag :</strong> <span v-if="dragMode" style="color: #10b981; font-weight: bold;">Activ√©</span><span v-else style="color: #6b7280;">D√©sactiv√©</span></p>
                    <p><strong>Mode debug :</strong> <span v-if="debugMode" style="color: #f59e0b; font-weight: bold;">Activ√©</span><span v-else style="color: #6b7280;">D√©sactiv√©</span></p>
                </div>
                
                <div class="drag-instructions">
                    <h5>üéØ Instructions Drag & Drop avec Fixation</h5>
                    <p><strong>Mode normal :</strong> Cliquez pour s√©lectionner une dent</p>
                    <p><strong>Mode drag :</strong> Cliquez et maintenez pour d√©placer les zones</p>
                    <p><strong>D√©placement :</strong> Glissez la souris pour d√©placer</p>
                    <p><strong>Fixation :</strong> Rel√¢chez pour fixer d√©finitivement la position</p>
                    <p><strong>Zones fix√©es :</strong> Apparaissent en vert pour indiquer qu'elles sont fix√©es</p>
                </div>
                
                <div class="drag-status" :class="{ 'status-active': isDragging }">
                    <h5>üéØ Statut du Drag</h5>
                    <p><strong>√âtat :</strong> <span v-if="isDragging" style="color: #10b981; font-weight: bold;">En cours de drag</span><span v-else style="color: #6b7280;">Aucun drag</span></p>
                    <p><strong>Zone en cours :</strong> <span v-if="currentDraggingTooth" style="color: #3b82f6; font-weight: bold;">{{ currentDraggingTooth }}</span><span v-else style="color: #6b7280;">Aucune</span></p>
                    <p><strong>Position :</strong> <span v-if="isDragging">X: {{ mouseX }}, Y: {{ mouseY }}</span><span v-else style="color: #6b7280;">Non disponible</span></p>
                </div>
                
                <div class="fixed-zones">
                    <h5>üîí Zones Fix√©es</h5>
                    <p><strong>Nombre de zones fix√©es :</strong> <span style="color: #10b981; font-weight: bold;">{{ fixedZones.length }}</span></p>
                    <p><strong>Zones fix√©es :</strong> <span v-if="fixedZones.length > 0">{{ fixedZones.join(', ') }}</span><span v-else style="color: #6b7280;">Aucune zone fix√©e</span></p>
                </div>
                
                <div class="zone-controls">
                    <h5>üéØ Contr√¥les des Zones</h5>
                    <p><strong>Mode normal :</strong> Cliquez pour s√©lectionner une dent</p>
                    <p><strong>Mode drag :</strong> Cliquez et maintenez pour d√©placer les zones</p>
                    <p><strong>Mode debug :</strong> Affiche les coordonn√©es des zones</p>
                    <p><strong>R√©initialiser :</strong> Remet toutes les zones √† leur position par d√©faut</p>
                    <p><strong>Fixer toutes :</strong> Fixe toutes les zones √† leur position actuelle</p>
                </div>
                
                <div class="dental-chart-container">
                    <div class="chart-section">
                        <h3>üìä Diagramme Dentaire avec Drag Fix√©</h3>
                        <div class="image-container" @mousemove="handleMouseMove" @mouseup="handleMouseUp" @mouseleave="handleMouseLeave">
                            <img src="/images/dental-reference.jpg?v=fixed&ts=202508062070" alt="Diagramme dentaire r√©aliste" class="dental-image">
                            <div class="tooth-overlay">
                                <!-- Dents sup√©rieures (quadrants 1 et 2) -->
                                <!-- Quadrant 1 (droite sup√©rieure) -->
                                <div class="tooth-zone" style="top: 100px; left: 350px;" data-tooth-id="11">11</div>
                                <div class="tooth-zone" style="top: 100px; left: 320px;" data-tooth-id="12">12</div>
                                <div class="tooth-zone" style="top: 100px; left: 290px;" data-tooth-id="13">13</div>
                                <div class="tooth-zone" style="top: 100px; left: 260px;" data-tooth-id="14">14</div>
                                <div class="tooth-zone" style="top: 100px; left: 230px;" data-tooth-id="15">15</div>
                                <div class="tooth-zone" style="top: 100px; left: 200px;" data-tooth-id="16">16</div>
                                <div class="tooth-zone" style="top: 100px; left: 170px;" data-tooth-id="17">17</div>
                                <div class="tooth-zone" style="top: 100px; left: 140px;" data-tooth-id="18">18</div>
                                
                                <!-- Quadrant 2 (gauche sup√©rieure) -->
                                <div class="tooth-zone" style="top: 100px; left: 430px;" data-tooth-id="21">21</div>
                                <div class="tooth-zone" style="top: 100px; left: 460px;" data-tooth-id="22">22</div>
                                <div class="tooth-zone" style="top: 100px; left: 490px;" data-tooth-id="23">23</div>
                                <div class="tooth-zone" style="top: 100px; left: 520px;" data-tooth-id="24">24</div>
                                <div class="tooth-zone" style="top: 100px; left: 550px;" data-tooth-id="25">25</div>
                                <div class="tooth-zone" style="top: 100px; left: 580px;" data-tooth-id="26">26</div>
                                <div class="tooth-zone" style="top: 100px; left: 610px;" data-tooth-id="27">27</div>
                                <div class="tooth-zone" style="top: 100px; left: 640px;" data-tooth-id="28">28</div>
                                
                                <!-- Dents inf√©rieures (quadrants 3 et 4) -->
                                <!-- Quadrant 3 (gauche inf√©rieure) -->
                                <div class="tooth-zone" style="top: 460px; left: 430px;" data-tooth-id="31">31</div>
                                <div class="tooth-zone" style="top: 460px; left: 460px;" data-tooth-id="32">32</div>
                                <div class="tooth-zone" style="top: 460px; left: 490px;" data-tooth-id="33">33</div>
                                <div class="tooth-zone" style="top: 460px; left: 520px;" data-tooth-id="34">34</div>
                                <div class="tooth-zone" style="top: 460px; left: 550px;" data-tooth-id="35">35</div>
                                <div class="tooth-zone" style="top: 460px; left: 580px;" data-tooth-id="36">36</div>
                                <div class="tooth-zone" style="top: 460px; left: 610px;" data-tooth-id="37">37</div>
                                <div class="tooth-zone" style="top: 460px; left: 640px;" data-tooth-id="38">38</div>
                                
                                <!-- Quadrant 4 (droite inf√©rieure) -->
                                <div class="tooth-zone" style="top: 460px; left: 350px;" data-tooth-id="41">41</div>
                                <div class="tooth-zone" style="top: 460px; left: 320px;" data-tooth-id="42">42</div>
                                <div class="tooth-zone" style="top: 460px; left: 290px;" data-tooth-id="43">43</div>
                                <div class="tooth-zone" style="top: 460px; left: 260px;" data-tooth-id="44">44</div>
                                <div class="tooth-zone" style="top: 460px; left: 230px;" data-tooth-id="45">45</div>
                                <div class="tooth-zone" style="top: 460px; left: 200px;" data-tooth-id="46">46</div>
                                <div class="tooth-zone" style="top: 460px; left: 170px;" data-tooth-id="47">47</div>
                                <div class="tooth-zone" style="top: 460px; left: 140px;" data-tooth-id="48">48</div>
                            </div>
                        </div>
                        <div class="controls">
                            <button @click="clearSelection" class="btn">üóëÔ∏è Effacer la s√©lection</button>
                            <button @click="selectRandomTooth" class="btn">üé≤ S√©lectionner al√©atoire</button>
                            <button @click="toggleDragMode" class="btn" :class="{ 'success': dragMode }">üéØ Mode Drag</button>
                            <button @click="toggleDebugMode" class="btn warning" :class="{ 'success': debugMode }">üîç Mode Debug</button>
                            <button @click="resetZones" class="btn secondary">üîÑ R√©initialiser zones</button>
                            <button @click="fixAllZones" class="btn success">üîí Fixer toutes les zones</button>
                            <button @click="unfixAllZones" class="btn warning">üîì D√©fixer toutes les zones</button>
                            <button @click="refreshPage" class="btn">üîÑ Actualiser la page</button>
                            <button @click="stopDrag" class="btn danger" v-if="isDragging">üõë Arr√™ter le drag</button>
                        </div>
                        
                        <div v-if="debugMode" class="position-display">
                            <h5>üìä Positions des zones (Mode Debug)</h5>
                            <div v-for="zone in zonePositions" :key="zone.id">
                                <strong>{{ zone.id }}:</strong> top: {{ zone.top }}px, left: {{ zone.left }}px
                                <span v-if="fixedZones.includes(zone.id)" style="color: #10b981;"> (FIX√â)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <div v-if="selectedTooth" class="tooth-info">
                            <h3>ü¶∑ Dent s√©lectionn√©e : {{ selectedTooth }}</h3>
                            <div class="tooth-details">
                                <p><strong>Type :</strong> {{ getToothType(selectedTooth) }}</p>
                                <p><strong>Quadrant :</strong> {{ getQuadrant(selectedTooth) }}</p>
                                <p><strong>Position :</strong> {{ getPosition(selectedTooth) }}</p>
                                <p><strong>Statut :</strong> <span v-if="fixedZones.includes(selectedTooth)" style="color: #10b981; font-weight: bold;">Fix√©e</span><span v-else style="color: #6b7280;">Non fix√©e</span></p>
                            </div>
                        </div>
                        <div v-else class="no-selection">
                            <h3>üëÜ Cliquez sur une zone bleue</h3>
                            <p>Les zones cliquables sont visibles en bleu</p>
                        </div>
                        
                        <div class="stats">
                            <h4>üìà Statistiques</h4>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-number">{{ toothHistory.length }}</div>
                                    <div class="stat-label">S√©lections</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">{{ uniqueTeeth.length }}</div>
                                    <div class="stat-label">Dents uniques</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">{{ fixedZones.length }}</div>
                                    <div class="stat-label">Zones fix√©es</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">{{ 32 - fixedZones.length }}</div>
                                    <div class="stat-label">Zones libres</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="history">
                            <h4>üìù Historique des s√©lections</h4>
                            <div v-for="(tooth, index) in toothHistory.slice(-5)" :key="index" class="history-item">
                                {{ tooth }} ({{ getToothType(tooth) }})
                                <span v-if="fixedZones.includes(tooth)" style="color: #10b981;"> ‚úì</span>
                            </div>
                            <div v-if="toothHistory.length === 0" class="no-selection">
                                Aucune s√©lection encore
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const { createApp, ref, computed } = Vue;
        
        createApp({
            setup() {
                const selectedTooth = ref(null);
                const toothHistory = ref([]);
                const dragMode = ref(false);
                const debugMode = ref(false);
                const isDragging = ref(false);
                const currentDraggingTooth = ref(null);
                const mouseX = ref(0);
                const mouseY = ref(0);
                const initialMouseX = ref(0);
                const initialMouseY = ref(0);
                const initialToothX = ref(0);
                const initialToothY = ref(0);
                const fixedZones = ref([]);
                
                const uniqueTeeth = computed(() => {
                    return [...new Set(toothHistory.value)];
                });
                
                const zonePositions = computed(() => {
                    if (!debugMode.value) return [];
                    const zones = document.querySelectorAll('.tooth-zone');
                    return Array.from(zones).map(zone => ({
                        id: zone.getAttribute('data-tooth-id'),
                        top: parseInt(zone.style.top),
                        left: parseInt(zone.style.left)
                    }));
                });
                
                const initializeDentalChart = () => {
                    console.log('Diagramme dentaire avec drag fix√© initialis√©');
                    setupZoneEvents();
                };
                
                const setupZoneEvents = () => {
                    const toothZones = document.querySelectorAll('.tooth-zone');
                    toothZones.forEach(zone => {
                        // √âv√©nement de clic pour s√©lection
                        zone.addEventListener('click', function(e) {
                            if (!dragMode.value) {
                                e.preventDefault();
                                e.stopPropagation();
                                const toothId = this.getAttribute('data-tooth-id');
                                selectTooth(toothId);
                                console.log('Zone cliqu√©e:', toothId);
                            }
                        });
                        
                        // √âv√©nement mousedown pour drag
                        zone.addEventListener('mousedown', function(e) {
                            if (dragMode.value) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                const toothId = this.getAttribute('data-tooth-id');
                                
                                // V√©rifier si la zone est fix√©e
                                if (fixedZones.value.includes(toothId)) {
                                    console.log('Zone fix√©e, impossible de d√©placer:', toothId);
                                    return;
                                }
                                
                                isDragging.value = true;
                                currentDraggingTooth.value = toothId;
                                
                                // Stocker les positions initiales
                                initialMouseX.value = e.clientX;
                                initialMouseY.value = e.clientY;
                                initialToothX.value = parseInt(this.style.left);
                                initialToothY.value = parseInt(this.style.top);
                                
                                // Ajouter la classe dragging
                                this.classList.add('dragging');
                                
                                console.log('D√©but du drag pour:', currentDraggingTooth.value);
                            }
                        });
                    });
                };
                
                const handleMouseMove = (e) => {
                    if (isDragging.value && currentDraggingTooth.value) {
                        mouseX.value = e.clientX;
                        mouseY.value = e.clientY;
                        
                        const zone = document.querySelector(`[data-tooth-id="${currentDraggingTooth.value}"]`);
                        if (zone) {
                            // Calculer le d√©placement
                            const dx = e.clientX - initialMouseX.value;
                            const dy = e.clientY - initialMouseY.value;
                            
                            // Calculer les nouvelles positions
                            const newX = initialToothX.value + dx;
                            const newY = initialToothY.value + dy;
                            
                            // Limiter les positions dans les limites du conteneur
                            const container = document.querySelector('.image-container');
                            const containerRect = container.getBoundingClientRect();
                            const zoneRect = zone.getBoundingClientRect();
                            
                            const maxX = containerRect.width - zoneRect.width;
                            const maxY = containerRect.height - zoneRect.height;
                            
                            const clampedX = Math.max(0, Math.min(newX, maxX));
                            const clampedY = Math.max(0, Math.min(newY, maxY));
                            
                            // Appliquer les nouvelles positions
                            zone.style.left = clampedX + 'px';
                            zone.style.top = clampedY + 'px';
                        }
                    }
                };
                
                const handleMouseUp = (e) => {
                    if (isDragging.value && currentDraggingTooth.value) {
                        const zone = document.querySelector(`[data-tooth-id="${currentDraggingTooth.value}"]`);
                        if (zone) {
                            zone.classList.remove('dragging');
                            
                            // Fixer la zone √† sa nouvelle position
                            if (!fixedZones.value.includes(currentDraggingTooth.value)) {
                                fixedZones.value.push(currentDraggingTooth.value);
                                zone.classList.add('fixed');
                                console.log('Zone fix√©e:', currentDraggingTooth.value);
                            }
                        }
                        
                        console.log('Fin du drag pour:', currentDraggingTooth.value);
                        isDragging.value = false;
                        currentDraggingTooth.value = null;
                    }
                };
                
                const handleMouseLeave = (e) => {
                    if (isDragging.value && currentDraggingTooth.value) {
                        handleMouseUp(e);
                    }
                };
                
                const stopDrag = () => {
                    if (isDragging.value) {
                        const zone = document.querySelector(`[data-tooth-id="${currentDraggingTooth.value}"]`);
                        if (zone) {
                            zone.classList.remove('dragging');
                        }
                        isDragging.value = false;
                        currentDraggingTooth.value = null;
                        console.log('Drag arr√™t√© manuellement');
                    }
                };
                
                const selectTooth = (toothId) => {
                    // D√©s√©lectionner la dent pr√©c√©demment s√©lectionn√©e
                    if (selectedTooth.value) {
                        const prevZone = document.querySelector(`[data-tooth-id="${selectedTooth.value}"]`);
                        if (prevZone) {
                            prevZone.classList.remove('selected');
                        }
                    }
                    
                    // S√©lectionner la nouvelle dent
                    selectedTooth.value = toothId;
                    const zone = document.querySelector(`[data-tooth-id="${toothId}"]`);
                    if (zone) {
                        zone.classList.add('selected');
                    }
                    
                    toothHistory.value.push(toothId);
                    console.log('Dent s√©lectionn√©e:', toothId);
                };
                
                const clearSelection = () => {
                    selectedTooth.value = null;
                    const selectedZone = document.querySelector('.tooth-zone.selected');
                    if (selectedZone) {
                        selectedZone.classList.remove('selected');
                    }
                };
                
                const selectRandomTooth = () => {
                    const teeth = ['11', '12', '13', '14', '15', '16', '17', '18',
                                  '21', '22', '23', '24', '25', '26', '27', '28',
                                  '31', '32', '33', '34', '35', '36', '37', '38',
                                  '41', '42', '43', '44', '45', '46', '47', '48'];
                    const randomTooth = teeth[Math.floor(Math.random() * teeth.length)];
                    selectTooth(randomTooth);
                };
                
                const toggleDragMode = () => {
                    dragMode.value = !dragMode.value;
                    const zones = document.querySelectorAll('.tooth-zone');
                    zones.forEach(zone => {
                        if (dragMode.value) {
                            zone.style.cursor = 'grab';
                        } else {
                            zone.style.cursor = 'pointer';
                        }
                    });
                    console.log('Mode drag:', dragMode.value ? 'activ√©' : 'd√©sactiv√©');
                };
                
                const toggleDebugMode = () => {
                    debugMode.value = !debugMode.value;
                };
                
                const fixAllZones = () => {
                    const zones = document.querySelectorAll('.tooth-zone');
                    zones.forEach(zone => {
                        const toothId = zone.getAttribute('data-tooth-id');
                        if (!fixedZones.value.includes(toothId)) {
                            fixedZones.value.push(toothId);
                            zone.classList.add('fixed');
                        }
                    });
                    console.log('Toutes les zones ont √©t√© fix√©es');
                };
                
                const unfixAllZones = () => {
                    const zones = document.querySelectorAll('.tooth-zone');
                    zones.forEach(zone => {
                        zone.classList.remove('fixed');
                    });
                    fixedZones.value = [];
                    console.log('Toutes les zones ont √©t√© d√©fix√©es');
                };
                
                const resetZones = () => {
                    // R√©initialiser les positions des zones
                    const zones = document.querySelectorAll('.tooth-zone');
                    const defaultPositions = {
                        '11': 'top: 100px; left: 350px;', '12': 'top: 100px; left: 320px;', '13': 'top: 100px; left: 290px;', '14': 'top: 100px; left: 260px;',
                        '15': 'top: 100px; left: 230px;', '16': 'top: 100px; left: 200px;', '17': 'top: 100px; left: 170px;', '18': 'top: 100px; left: 140px;',
                        '21': 'top: 100px; left: 430px;', '22': 'top: 100px; left: 460px;', '23': 'top: 100px; left: 490px;', '24': 'top: 100px; left: 520px;',
                        '25': 'top: 100px; left: 550px;', '26': 'top: 100px; left: 580px;', '27': 'top: 100px; left: 610px;', '28': 'top: 100px; left: 640px;',
                        '31': 'top: 460px; left: 430px;', '32': 'top: 460px; left: 460px;', '33': 'top: 460px; left: 490px;', '34': 'top: 460px; left: 520px;',
                        '35': 'top: 460px; left: 550px;', '36': 'top: 460px; left: 580px;', '37': 'top: 460px; left: 610px;', '38': 'top: 460px; left: 640px;',
                        '41': 'top: 460px; left: 350px;', '42': 'top: 460px; left: 320px;', '43': 'top: 460px; left: 290px;', '44': 'top: 460px; left: 260px;',
                        '45': 'top: 460px; left: 230px;', '46': 'top: 460px; left: 200px;', '47': 'top: 460px; left: 170px;', '48': 'top: 460px; left: 140px;'
                    };
                    
                    zones.forEach(zone => {
                        const toothId = zone.getAttribute('data-tooth-id');
                        if (defaultPositions[toothId]) {
                            zone.style = defaultPositions[toothId];
                        }
                        zone.classList.remove('fixed');
                    });
                    
                    fixedZones.value = [];
                    clearSelection();
                };
                
                const refreshPage = () => {
                    window.location.reload();
                };
                
                const getToothType = (toothId) => {
                    const position = parseInt(toothId.slice(1));
                    if (position <= 2) return 'Incisive';
                    if (position === 3) return 'Canine';
                    if (position <= 5) return 'Pr√©molaire';
                    return 'Molaire';
                };
                
                const getQuadrant = (toothId) => {
                    const quadrant = toothId.slice(0, 1);
                    const names = {
                        '1': 'Sup√©rieur Droit',
                        '2': 'Sup√©rieur Gauche', 
                        '3': 'Inf√©rieur Gauche',
                        '4': 'Inf√©rieur Droit'
                    };
                    return names[quadrant] || 'Inconnu';
                };
                
                const getPosition = (toothId) => {
                    return toothId.slice(1);
                };
                
                // Initialiser quand le DOM est pr√™t
                document.addEventListener('DOMContentLoaded', initializeDentalChart);
                
                return {
                    selectedTooth,
                    toothHistory,
                    uniqueTeeth,
                    dragMode,
                    debugMode,
                    isDragging,
                    currentDraggingTooth,
                    mouseX,
                    mouseY,
                    fixedZones,
                    zonePositions,
                    initializeDentalChart,
                    selectTooth,
                    clearSelection,
                    selectRandomTooth,
                    toggleDragMode,
                    toggleDebugMode,
                    resetZones,
                    fixAllZones,
                    unfixAllZones,
                    refreshPage,
                    stopDrag,
                    handleMouseMove,
                    handleMouseUp,
                    handleMouseLeave,
                    getToothType,
                    getQuadrant,
                    getPosition
                };
            }
        }).mount('#app');
    </script>
</body>
</html> 